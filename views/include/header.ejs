<head>
    <meta charset="UTF-8" />
    <title>Headers - 4</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="styles/reset.min.css" />
    <link rel="stylesheet" href="styles/style.css" />
    <link rel="stylesheet" href="/static/css/header.css" />
</head>
<body>
    <!-- Header Start -->
    <nav class="navbar navbar-expand-lg">
        <div class="container-fluid">
            <a id="logo" href="#">BBGG</a>
            <form class="d-flex" role="search">
                <input
                    class="form-control me-2"
                    type="search"
                    placeholder="Search"
                    aria-label="Search"
                />
                <a href="#" id="btn-search" type="submit"
                    ><img src="../../static/css/image/icon_search.png"
                /></a>
            </form>
            <div id="menu">
                <a id="btn-chat" href="#">Chat</a>

                <a id="btn-mypage" href="#">Mypage</a>

                <a id="btn-user" href="#"></a>

                <a id="btn-login" type="submit" href="users/signin"> Login </a>
            </div>
        </div>
    </nav>
    <!-- Header End -->
    <script>
        (async () => {
            const info = document.getElementById("info");
            const accessToken = localStorage.getItem("accessToken");

            let data = "";
            if (!accessToken) {
                data = '<a href="/users/signin">로그인</a>';
            } else {
                const response = await axios({
                    method: "POST",
                    url: "/users/accesstoken",
                    headers: {
                        Authorization: `Bearer ${accessToken}`,
                    },
                });
                if (response.data.result) {
                    // 사용자 이름을 포함한 데이터 생성
                    data = `
        <p>${response.data.name}님 환영합니다.</p>
        <button type="button" onclick="signout()">로그아웃</button>
    `;
                    // 로그인 버튼을 로그아웃 버튼으로 변경
                    const loginButton = document.getElementById("btn-login");
                    loginButton.innerHTML = "logout";
                    loginButton.removeAttribute("href"); // 로그인 링크 제거
                    loginButton.onclick = signout; // onclick 이벤트에 signout 함수 할당

                    const userButton = document.getElementById("btn-user");
                    userButton.innerHTML = `${response.data.name}님`;
                }
            }
            // info.innerHTML = data; // 로그인 버튼 나오도록 하기
        })();

        function signout() {
            // 로컬 스토리지에서 jwt 정보 삭제
            localStorage.clear();

            // 새로고침으로 뷰 화면 변경
            document.location.reload();
        }
    </script>
</body>
